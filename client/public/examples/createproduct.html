<!DOCTYPE html>
<html>

<head>
    <title>Create Product</title>
    <style>
        .color-palette {
            display: flex;
            flex-wrap: wrap;
        }

        .color-palette .color {
            width: 50px;
            height: 50px;
            margin: 5px;
            cursor: pointer;
        }

        .color-circle {
            width: 200px;
            height: 200px;
            background-color: #ccc;
            border-radius: 50%;
            margin-top: 20px;
            position: relative;
        }

        .color-circle .color {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
    </style>
</head>

<body>
    <h1>Create a New Product</h1>
    <h4>login before submit new product. product brand name will use username of owner as a value</h2>
    <form id="productForm" enctype="multipart/form-data" action="http://localhost:3000/api/v1/products" method="POST">
        <fieldset>
            <legend>Product Information</legend>
    
            <label for="name">Name:</label>
            <input type="text" id="name" name="name" required><br><br>
    
            <label for="description">Description:</label>
            <textarea id="description" name="description" required></textarea><br><br>
        </fieldset>
    
        <fieldset>
            <legend>Category</legend>
    
            <select id="category1" name="gender">
                <option value="">Select a gender</option>
                <option value="male">ชาย</option>
                <option value="female">หญิง</option>
            </select>
    
            <select id="category2" name="className" disabled>
                <option value="">Select a class</option>
                <option value="male">ชาย</option>
                <option value="female">หญิง</option>
            </select>
    
            <select id="category3" name="category" disabled>
                <option value="">Select a category</option>
                <option value="male">ชาย</option>
                <option value="female">หญิง</option>
            </select><br><br>
        </fieldset>
    
        <fieldset>
            <legend>Additional Information</legend>
    
            <label for="tags">Tags (comma-separated):</label>
            <input type="text" id="tags" name="tags">
    
            <label for="variants">Variants:</label>
            <button type="button" id="addVariant">Add Variant</button>
            <div id="variantFields">
                <!-- Variant fields will be added here -->
            </div>
        </fieldset>
    
        <input type="submit" value="Create Product">
    </form>
    

    <script>
        // JavaScript code to handle form submission
        const form = document.getElementById('productForm');
        const variantFields = document.getElementById('variantFields');
        const addVariantButton = document.getElementById('addVariant');

        // Function to add variant fields dynamically
        // Function to add variant fields dynamically
        function addVariantField() {
            const variantField = document.createElement('div');
            variantField.classList.add('variant');
            variantField.innerHTML = `
                <hr>
                <label for="price">Price:</label>
                <input type="number" name="variants[][price]" required><br>

                <label for="size">Size:</label>
                <select name="variants[][size]" required>
                    <option value="XS">XS</option>
                    <option value="S">S</option>
                    <option value="M">M</option>
                    <option value="L">L</option>
                    <option value="XL">XL</option>
                    <option value="XXL">XXL</option>
                    <option value="3XL">3XL</option>
                </select>
                <br>


                <label for="color">Color:</label>
                <input type="color" id="color" name="variants[][color]" value="#FF0000"><br>

                <label for="quantity">Quantity:</label>
                <input type="number" name="variants[][quantity]" required><br>

                <label for="image">Image:</label>
                <input type="file" name="variants[][image]" required><br>
                
                <button type="button" class="removeVariant">Remove Variant</button>
            `;

            // Add a click event listener to the "Remove Variant" button
            const removeVariantButton = variantField.querySelector('.removeVariant');
            removeVariantButton.addEventListener('click', () => {
                variantField.remove();
            });

            variantFields.appendChild(variantField);
        }


        // Add variant fields when the button is clicked
        addVariantButton.addEventListener('click', addVariantField);

        // Submit form data to the API
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(form);
            try {
                const response = await fetch('http://localhost:3000/api/v1/products', {
                    method: 'POST',
                    body: formData,
                    credentials: "include",
                });
                const responseData = await response.json();
                alert(JSON.stringify(responseData));
            } catch (error) {
                console.error('Error:', error);
            }
        });
    </script>

    <script>
        // Fetch the category hierarchy from the URL
        fetch('http://localhost:3000/api/v1/categories/hierarchy-for-merchant')
            .then(response => response.json())
            .then(data => {
                const firstLevel = document.getElementById('category1');
                const secondLevel = document.getElementById('category2');
                const thirdLevel = document.getElementById('category3');

                // Populate the first level dropdown
                data.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category.name;
                    option.textContent = category.name;
                    firstLevel.appendChild(option);
                });

                // Handle first-level selection change
                firstLevel.addEventListener('change', () => {
                    const selectedFirstLevel = firstLevel.value;
                    secondLevel.innerHTML = '<option value="">Select a class</option>';
                    thirdLevel.innerHTML = '<option value="">Select a category</option>';
                    secondLevel.disabled = true;
                    thirdLevel.disabled = true;

                    if (selectedFirstLevel) {
                        // Find the selected category in the data
                        const selectedCategory = data.find(category => category.name === selectedFirstLevel);

                        if (selectedCategory && selectedCategory.items) {
                            // Populate the second level dropdown if there are items
                            selectedCategory.items.forEach(subcategory => {
                                const option = document.createElement('option');
                                option.value = subcategory.name;
                                option.textContent = subcategory.name;
                                secondLevel.appendChild(option);
                            });

                            secondLevel.disabled = false;
                        }
                    }
                });

                // Handle second-level selection change
                secondLevel.addEventListener('change', () => {
                    const selectedSecondLevel = secondLevel.value;
                    thirdLevel.innerHTML = '<option value="">Select a category</option>';
                    thirdLevel.disabled = true;

                    // Check if the selected subcategory has items
                    const selectedCategory = data.find(category => category.name === firstLevel.value);
                    if (selectedCategory && selectedCategory.items) {
                        const selectedSubcategory = selectedCategory.items.find(subcategory => subcategory.name === selectedSecondLevel);

                        if (selectedSubcategory && selectedSubcategory.items) {
                            // Populate the third level dropdown if there are sub-subcategories
                            selectedSubcategory.items.forEach(subSubcategory => {
                                const option = document.createElement('option');
                                option.value = subSubcategory;
                                option.textContent = subSubcategory;
                                thirdLevel.appendChild(option);
                            });

                            thirdLevel.disabled = false;
                        }
                    }
                });
            })
            .catch(error => console.error('Error fetching data:', error));

            
    </script>
        <script>
            const paletteColors = document.querySelectorAll('.color-palette .color');
            const circleColors = document.getElementById('circle');
    
            // Function to handle color selection from the palette
            function selectPaletteColor(event) {
                const selectedColor = event.target.style.backgroundColor;
                alert(`You selected color: ${selectedColor}`);
            }
    
            // Add click event listeners to palette colors
            paletteColors.forEach(color => {
                color.addEventListener('click', selectPaletteColor);
            });
    
            // Function to handle color selection from the circle
            function selectCircleColor(event) {
                const selectedColor = event.target.style.backgroundColor;
                alert(`You selected color: ${selectedColor}`);
            }
    
            // Create color options in the circle dynamically
            const circleColorOptions = ['#FF5733', '#33FF57', '#5733FF', '#FFFF33', '#33FFFF'];
            circleColorOptions.forEach(color => {
                const colorDiv = document.createElement('div');
                colorDiv.className = 'color';
                colorDiv.style.backgroundColor = color;
                colorDiv.addEventListener('click', selectCircleColor);
                circleColors.appendChild(colorDiv);
            });
        </script>
</body>

</html>